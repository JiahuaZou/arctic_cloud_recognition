---
title: "154project2"
author: "Jiahua"
date: "4/26/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
columns <- c("y", "x", "label", "NDAI", "SD", "CORR", "DF", "CF", "BF", "AF", "AN")

image1 <- read.table("image_data/image1.txt", header = FALSE, col.names = columns)
image2 <- read.table("image_data/image2.txt", header = FALSE, col.names = columns)
image3 <- read.table("image_data/image3.txt", header = FALSE, col.names = columns)

image1$class <- rep(1, nrow(image1))
image2$class <- rep(2, nrow(image2))
image3$class <- rep(3, nrow(image3))

```
    
```{r}
library(e1071)
library(ggplot2)
library(corrplot)
library(dplyr)
library(MASS)
library(caret)
```
    
Section 1: Data Collection and Exploration  
1b.  
```{r}
ggplot(data = image1) +
  geom_point(aes(x = x, y = y, color = factor(label))) +
  scale_color_manual(values=(brewer.pal(3, "Purples"))[3:1]) +
  scale_x_continuous(breaks = seq(0, 400, 50)) +
  scale_y_continuous(breaks = seq(65, 370, 50)) +
  xlab("x coordinate") +
  ylab("y coordinate") +
  ggtitle("distribution of cloud and non-cloud (1)") +
  theme_bw()
ggplot(data = image2) +
  geom_point(aes(x = x, y = y, color = factor(label))) +
  scale_color_manual(values=(brewer.pal(3, "Purples"))[3:1]) +
  scale_x_continuous(breaks = seq(0, 400, 50)) +
  scale_y_continuous(breaks = seq(65, 370, 50)) +
  xlab("x coordinate") +
  ylab("y coordinate") +
  ggtitle("distribution of cloud and non-cloud (2)") +
  theme_bw()
ggplot(data = image3) +
  geom_point(aes(x = x, y = y, color = factor(label))) +
  scale_color_manual(values=(brewer.pal(3, "Purples"))[3:1]) +
  scale_x_continuous(breaks = seq(0, 400, 50)) +
  scale_y_continuous(breaks = seq(65, 370, 50)) +
  xlab("x coordinate") +
  ylab("y coordinate") +
  ggtitle("distribution of cloud and non-cloud (3)") +
  theme_bw()
```

1c.
```{r}
# corrplot, label vs all
corrplot(cor(image1[,3:11]), type="upper",tl.col="black", tl.srt=45)
corrplot(cor(image2[,3:11]), type="upper",tl.col="black", tl.srt=45)
corrplot(cor(image3[,3:11]), type="upper",tl.col="black", tl.srt=45)

# Boxplot, label vs NDAI/SD/CORR
gg1_NDAI <- ggplot(data = image1) +
  geom_boxplot(aes(x = factor(label), y = NDAI)) +
  xlab("Label") +
  ylab("NDAI") +
  ggtitle("label vs NDAI") +
  theme_bw()
gg1_SD <- ggplot(data = image1) +
  geom_boxplot(aes(x = factor(label), y = SD)) +
  xlab("Label") +
  ylab("SD") +
  ggtitle("label vs SD") +
  theme_bw()
gg1_CORR <- ggplot(data = image1) +
  geom_boxplot(aes(x = factor(label), y = CORR)) +
  xlab("Label") +
  ylab("CORR") +
  ggtitle("label vs CORR") +
  theme_bw()
gg2_NDAI <- ggplot(data = image2) +
  geom_boxplot(aes(x = factor(label), y = NDAI)) +
  xlab("Label") +
  ylab("NDAI") +
  ggtitle("label vs NDAI") +
  theme_bw()
gg2_SD <- ggplot(data = image2) +
  geom_boxplot(aes(x = factor(label), y = SD)) +
  xlab("Label") +
  ylab("SD") +
  ggtitle("label vs SD") +
  theme_bw()
gg2_CORR <- ggplot(data = image2) +
  geom_boxplot(aes(x = factor(label), y = CORR)) +
  xlab("Label") +
  ylab("CORR") +
  ggtitle("label vs CORR") +
  theme_bw()
gg3_NDAI <- ggplot(data = image3) +
  geom_boxplot(aes(x = factor(label), y = NDAI)) +
  xlab("Label") +
  ylab("NDAI") +
  ggtitle("label vs NDAI") +
  theme_bw()
gg3_SD <- ggplot(data = image3) +
  geom_boxplot(aes(x = factor(label), y = SD)) +
  xlab("Label") +
  ylab("SD") +
  ggtitle("label vs SD") +
  theme_bw()
gg3_CORR <- ggplot(data = image3) +
  geom_boxplot(aes(x = factor(label), y = CORR)) +
  xlab("Label") +
  ylab("CORR") +
  ggtitle("label vs CORR") +
  theme_bw()
gg1_NDAI; gg1_CORR; gg1_SD
gg2_NDAI; gg2_CORR; gg2_SD
gg3_NDAI; gg3_CORR; gg3_SD

```

    
    
Section 2: Preparation   
2a. defining function to help.        
```{r}
split_data <- function(data, func = cut_interval, xs = 3, ys = 3, size = 0.2, kind = "train") {
  #
  #
  #
  #
  #
  '%notin%' <- Negate('%in%')
  
  data_no0 <- data[data$label != 0, ]
  data_no0$xbins <- func(data_no0$x, xs, labels = seq(1:xs))
  data_no0$ybins <- func(data_no0$y, ys, labels = seq(1:ys))
  data_no0$blocks <- as.numeric(factor(paste0(data_no0$xbins, data_no0$ybins)))
  
  blocks <- length(unique(data_no0$blocks))
  test_idx_temp <- sample(seq(1:blocks), size * blocks)
  test_set_temp <- data_no0[data_no0$blocks %in% test_idx_temp, ]
  train_val_set_temp <- data_no0[data_no0$blocks %notin% test_idx_temp, ]

  #further splitting trainset into training and validation set.
  train_val_len_temp <- length(unique(train_val_set_temp$blocks))
  val_idx_temp <- sample(seq(1:train_val_len_temp), val_size * train_val_len_temp)
  val_set_temp <- train_val_set_temp[train_val_set_temp$blocks %in% val_idx_temp, ]
  train_set_temp <- train_val_set_temp[train_val_set_temp$blocks %notin% val_idx_temp, ]
  
  if (kind == "train") {
    return(train_set_temp)
  } else if (kind == "test") {
    return(test_set_temp)
  } else if (kind == "val") {
    return(val_set_temp)
  } else {
    return(train_val_set_temp)
  }
}
```

splitting data by block of equal area to address spatial CORRelation
```{r}
total_data <- list(image1, image2, image3)

helper1 <- total_data %>% lapply(split_data, kind = "train")
helper2 <- total_data %>% lapply(split_data, kind = "val")
helper3 <- total_data %>% lapply(split_data, kind = "test")
helper4 <- total_data %>% lapply(split_data, kind = "train_val")

train_set1 <- rbind(helper1[[1]], helper1[[2]], helper1[[3]])
val_set1 <- rbind(helper2[[1]], helper2[[2]], helper2[[3]])
test_set1 <- rbind(helper3[[1]], helper3[[2]], helper3[[3]])
train_val_set1 <- rbind(helper4[[1]], helper4[[2]], helper4[[3]])
```
    
2a. splitting data using blocks. But this time we split blocks by the equal number of observation in it. Not by the equal area as we have done previously. Use cut_number (equal observation) instead of cut_interval (equal length).   
```{r}
helper1 <- total_data %>% lapply(split_data, func = cut_number, kind = "train")
helper2 <- total_data %>% lapply(split_data, func = cut_number, kind = "val")
helper3 <- total_data %>% lapply(split_data, func = cut_number, kind = "test")
helper4 <- total_data %>% lapply(split_data, func = cut_number, kind = "train_val")

train_set2 <- rbind(helper1[[1]], helper1[[2]], helper1[[3]])
val_set2 <- rbind(helper2[[1]], helper2[[2]], helper2[[3]])
test_set2 <- rbind(helper3[[1]], helper3[[2]], helper3[[3]])
train_val_set2 <- rbind(helper4[[1]], helper4[[2]], helper4[[3]])
```
      
2b. trivial classifier    
```{r}
# accuracy for the trivial classifier that report everything as -1, is just the fraction of -1
# in the original data set
nrow(test_set2[test_set2$label == -1, ])/nrow(test_set2)
```



```{r}
total_no0 <- rbind(image1, image2, iamge3)[]
nrow(train_set1)
nrow(val_set1)
nrow(test_set1)

```



```{r}
nrow(train_set2)
nrow(val_set2)
nrow(test_set2)
nrow(total_data3)
```

```{r}
nrow(train_set1)
nrow(val_set1)
nrow(test_set1)
nrow(total_data2)
```

2b.
```{r}
head(total_data2)
total_label1 <- total_data2[which(total_data2$label == 1),]
total_label2 <- total_data2[which(total_data2$label == -1),] # This is label -1.

# QDA
model_qda1 <- qda(label ~ NDAI + SD + CORR, data = total_data2) # The Three featrures
pred_qda1 <- predict(model_qda1, total_data2)$class
(err_qda1 <- mean(pred_qda1 != total_data2$label))

model_qda2 <- qda(label ~ NDAI + CORR + AN, data = total_data2) # NDAI, CORR and AN. ------BEST
pred_qda2 <- predict(model_qda2, total_data2)$class
(err_qda2 <- mean(pred_qda2 != total_data2$label))

model_qda3 <- qda(label ~ NDAI + AF + AN, data = total_data2) # NDAI, AF and AN
pred_qda3 <- predict(model_qda3, total_data2)$class
(err_qda3 <- mean(pred_qda3 != total_data2$label))

model_qda4 <- qda(label ~ NDAI + SD + AN, data = total_data2) # NDAI, SD and AN
pred_qda4 <- predict(model_qda4, total_data2)$class
(err_qda4 <- mean(pred_qda4 != total_data2$label))

# Logistic
mode_logis1 <- glm(((label + 1)/2) ~ NDAI + SD + CORR, data = total_data2,
                   family = binomial(link = "logit")) # The Three featrures. ------BEST
yhat_logis1 <- predict(mode_logis1, total_data2, type = "response")
class_logis1 <- yhat_logis1 > 0.5
(err_logis1 <- mean(as.numeric(class_logis1) != (total_data2$label + 1)/2))

mode_logis2 <- glm(((label + 1)/2) ~ NDAI + CORR + AN, data = total_data2,
                   family = binomial(link = "logit"))  # NDAI, CORR and AN
yhat_logis2 <- predict(mode_logis2, total_data2, type = "response")
class_logis2 <- yhat_logis2 > 0.5
(err_logis2 <- mean(as.numeric(class_logis2) != (total_data2$label + 1)/2))

mode_logis3 <- glm(((label + 1)/2) ~ NDAI + AF + AN, data = total_data2,
                   family = binomial(link = "logit")) # NDAI, AF and AN
yhat_logis3 <- predict(mode_logis3, total_data2, type = "response")
class_logis3 <- yhat_logis3 > 0.5
(err_logis3 <- mean(as.numeric(class_logis3) != (total_data2$label + 1)/2))

mode_logis4 <- glm(((label + 1)/2) ~ NDAI + SD + AN, data = total_data2,
                   family = binomial(link = "logit")) # NDAI, SD and AN
yhat_logis4 <- predict(mode_logis4, total_data2, type = "response")
class_logis4 <- yhat_logis4 > 0.5
(err_logis4 <- mean(as.numeric(class_logis4) != (total_data2$label + 1)/2))

# SVM
svmfit = svm(y ~ ., data = dat, kernel = "linear", cost = 10, scale = FALSE)
print(svmfit)
```




